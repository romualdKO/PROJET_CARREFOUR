{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nouvelle Commande Fournisseur</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <script>
        function addProductRow() {
            const container = document.getElementById('produits-container');
            const index = container.children.length;
            const row = document.createElement('div');
            row.style.display = 'grid';
            row.style.gridTemplateColumns = '1fr 120px 120px 80px';
            row.style.gap = '10px';
            row.style.marginBottom = '10px';
            row.innerHTML = `
                <select name="produit[]" required style="padding:10px; border-radius:6px; border:1px solid #E5E7EB;">
                    <option value="">Sélectionner un produit</option>
                    {% for p in produits %}
                        <option value="{{ p.id }}">{{ p.nom }} - {{ p.categorie.nom }}</option>
                    {% endfor %}
                </select>
                <input type="number" name="quantite[]" min="1" placeholder="Quantité" required style="padding:10px; border-radius:6px; border:1px solid #E5E7EB;">
                <input type="number" step="0.01" name="prix_unitaire[]" placeholder="Prix Unitaire" style="padding:10px; border-radius:6px; border:1px solid #E5E7EB;">
                <button type="button" onclick="this.parentElement.remove()" style="background:#FEE2E2; border:none; color:#991B1B; padding:8px; border-radius:6px;">Suppr</button>
            `;
            container.appendChild(row);
        }
    </script>
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">🛒</div>
                <h2>SuperMarché Plus</h2>
                <p>Module Gestion Stock</p>
            </div>
            <nav class="sidebar-nav">
                <a href="{% url 'dashboard_stock' %}" class="nav-item">📊 Tableau de Bord</a>
                <a href="{% url 'stock_add_product' %}" class="nav-item">📦 Nouveau Produit</a>
                <a href="{% url 'stock_fournisseurs_list' %}" class="nav-item">🏭 Fournisseurs</a>
                <a href="{% url 'stock_commandes_list' %}" class="nav-item active">🧾 Commandes</a>
                <a href="{% url 'logout' %}" class="nav-item logout">🚪 Déconnexion</a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="content-header"><h1>Nouvelle Commande</h1><div class="user-info">👤 {{ user.get_full_name }}</div></header>

            {% if messages %}{% for message in messages %}<div class="alert alert-{{ message.tags }}">{{ message }}</div>{% endfor %}{% endif %}

            <div style="background:white; padding:20px; border-radius:8px;">
                <form method="post">
                    {% csrf_token %}
                    <div style="display:flex; gap:10px; margin-bottom:12px;">
                        <select name="fournisseur" required>
                            <option value="">Sélectionner un fournisseur</option>
                            {% for f in fournisseurs %}
                                <option value="{{ f.id }}">{{ f.nom }}</option>
                            {% endfor %}
                        </select>
                        <input type="date" name="date_livraison_prevue" />
                        <input type="text" name="notes" placeholder="Notes (optionnel)" />
                    </div>

                    <div id="produits-container"></div>
                    <div style="margin:12px 0;">
                        <button type="button" onclick="addProductRow()" class="btn">➕ Ajouter un produit</button>
                    </div>

                    <div style="display:flex; gap:10px; justify-content:flex-end;">
                        <a href="{% url 'stock_commandes_list' %}" class="btn">← Annuler</a>
                        <button type="submit" class="btn btn-primary">✅ Créer la commande</button>
                    </div>
                </form>
            </div>
        </main>
    </div>
</body>
</html>
