{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if presence %}Modifier{% else %}Ajouter{% endif %} Pr√©sence - RH</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">üõí</div>
                <h2>SuperMarch√© Plus</h2>
                <p>Module Ressources Humaines</p>
            </div>
            
            <nav class="sidebar-nav">
                <a href="{% url 'dashboard_rh' %}" class="nav-item">
                    <span class="icon">üìä</span>
                    <span>Tableau de Bord</span>
                </a>
                <a href="{% url 'rh_employees_list' %}" class="nav-item">
                    <span class="icon">üë•</span>
                    <span>Employ√©s</span>
                </a>
                <a href="{% url 'rh_create_employee' %}" class="nav-item">
                    <span class="icon">‚ûï</span>
                    <span>Nouvel Employ√©</span>
                </a>
                <a href="{% url 'rh_planifications' %}" class="nav-item">
                    <span class="icon">üìÖ</span>
                    <span>Planifications</span>
                </a>
                <a href="{% url 'rh_presences' %}" class="nav-item active">
                    <span class="icon">‚úÖ</span>
                    <span>Pr√©sences</span>
                </a>
                <a href="{% url 'rh_conges' %}" class="nav-item">
                    <span class="icon">üèñÔ∏è</span>
                    <span>Cong√©s</span>
                </a>
                <a href="{% url 'rh_formations' %}" class="nav-item">
                    <span class="icon">üéì</span>
                    <span>Formations</span>
                </a>
                <a href="{% url 'logout' %}" class="nav-item logout">
                    <span class="icon">üö™</span>
                    <span>D√©connexion</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>{% if presence %}‚úèÔ∏è Modifier Pr√©sence{% else %}‚ûï Ajouter Pr√©sence{% endif %}</h1>
                <div class="user-info">
                    <span>üë§ {{ user.get_full_name }}</span>
                </div>
            </header>

            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Formulaire -->
            <div class="card">
                <div class="card-header">
                    <h2>{% if presence %}Modifier la pr√©sence de {{ presence.employe.get_full_name }}{% else %}Enregistrer une nouvelle pr√©sence{% endif %}</h2>
                </div>
                <div class="card-body">
                    <form method="POST" style="max-width: 800px;">
                        {% csrf_token %}
                        
                        {% if not presence %}
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">
                                Employ√© *
                            </label>
                            <select name="employe_id" required style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; transition: border-color 0.3s;">
                                <option value="">S√©lectionner un employ√©...</option>
                                {% for employe in employes %}
                                    <option value="{{ employe.id }}">{{ employe.get_full_name }} - {{ employe.get_role_display }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">
                                Date *
                            </label>
                            <input type="date" name="date" value="{% if presence %}{{ presence.date|date:'Y-m-d' }}{% else %}{{ today }}{% endif %}" required style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; transition: border-color 0.3s;">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">
                                    Heure d'Arriv√©e
                                </label>
                                <input type="time" name="heure_arrivee" value="{% if presence and presence.heure_arrivee %}{{ presence.heure_arrivee|time:'H:i' }}{% endif %}" style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; transition: border-color 0.3s;">
                                <small style="color: #6B7280; font-size: 0.85em;">Laisser vide si absent</small>
                            </div>
                            
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">
                                    Heure de D√©part
                                </label>
                                <input type="time" name="heure_depart" value="{% if presence and presence.heure_depart %}{{ presence.heure_depart|time:'H:i' }}{% endif %}" style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; transition: border-color 0.3s;">
                                <small style="color: #6B7280; font-size: 0.85em;">Laisser vide si toujours pr√©sent</small>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">
                                Tol√©rance Retard (minutes avant d'√™tre marqu√© absent)
                            </label>
                            <input type="number" name="tolerance_retard" value="{% if presence %}{{ presence.tolerance_retard }}{% else %}60{% endif %}" min="0" max="180" style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; transition: border-color 0.3s;">
                            <small style="color: #6B7280; font-size: 0.85em;">Par d√©faut: 60 minutes (1 heure)</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">
                                Motif d'Absence (optionnel)
                            </label>
                            <textarea name="motif_absence" rows="3" style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; transition: border-color 0.3s; resize: vertical;">{% if presence %}{{ presence.motif_absence }}{% endif %}</textarea>
                        </div>
                        
                        <div style="background: #EFF6FF; padding: 16px; border-radius: 8px; border-left: 4px solid #3B82F6; margin-bottom: 20px;">
                            <h4 style="margin: 0 0 8px 0; color: #1E40AF; font-size: 0.95em;">
                                ‚ÑπÔ∏è R√®gles de Calcul du Statut
                            </h4>
                            <ul style="margin: 0; padding-left: 20px; color: #1E40AF; font-size: 0.85em;">
                                <li>üî¥ <strong>ABSENT</strong> : Si arriv√©e > tol√©rance OU heures travaill√©es < 60% des heures requises</li>
                                <li>üü° <strong>RETARD</strong> : Si arriv√©e entre 15min et tol√©rance ET heures travaill√©es ‚â• 60%</li>
                                <li>üü¢ <strong>PR√âSENT</strong> : Si arriv√©e ‚â§ 15min de retard ET heures travaill√©es ‚â• 60%</li>
                            </ul>
                        </div>
                        
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <a href="{% url 'rh_presences' %}" style="background: #6B7280; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600;">
                                Annuler
                            </a>
                            <button type="submit" style="background: linear-gradient(135deg, #10B981, #059669); color: white; padding: 12px 32px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1em;">
                                {% if presence %}üíæ Enregistrer{% else %}‚ûï Ajouter{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
