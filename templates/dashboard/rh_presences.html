{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Pr√©sences - RH</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">üõí</div>
                <h2>SuperMarch√© Plus</h2>
                <p>Module Ressources Humaines</p>
            </div>
            
            <nav class="sidebar-nav">
                <a href="{% url 'dashboard_rh' %}" class="nav-item">
                    <span class="icon">üìä</span>
                    <span>Tableau de Bord</span>
                </a>
                <a href="{% url 'rh_employees_list' %}" class="nav-item">
                    <span class="icon">üë•</span>
                    <span>Employ√©s</span>
                </a>
                <a href="{% url 'rh_create_employee' %}" class="nav-item">
                    <span class="icon">‚ûï</span>
                    <span>Nouvel Employ√©</span>
                </a>
                <a href="{% url 'rh_planifications' %}" class="nav-item">
                    <span class="icon">üìÖ</span>
                    <span>Planifications</span>
                </a>
                <a href="{% url 'rh_presences' %}" class="nav-item active">
                    <span class="icon">‚úÖ</span>
                    <span>Pr√©sences</span>
                </a>
                <a href="{% url 'rh_conges' %}" class="nav-item">
                    <span class="icon">üèñÔ∏è</span>
                    <span>Cong√©s</span>
                </a>
                <a href="{% url 'rh_formations' %}" class="nav-item">
                    <span class="icon">üéì</span>
                    <span>Formations</span>
                </a>
                <a href="{% url 'logout' %}" class="nav-item logout">
                    <span class="icon">üö™</span>
                    <span>D√©connexion</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>Gestion des Pr√©sences</h1>
                <div class="user-info">
                    <span>üë§ {{ user.get_full_name }}</span>
                </div>
            </header>

            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Pr√©sences du jour -->
            <div class="card">
                <div class="card-header">
                    <h2>üìÖ Pr√©sences du {{ today|date:"d/m/Y" }}</h2>
                    <p style="margin: 8px 0 0 0; color: #6B7280; font-size: 0.9em;">
                        ‚ÑπÔ∏è Les pr√©sences sont enregistr√©es automatiquement √† la connexion/d√©connexion des employ√©s
                    </p>
                </div>
                <div class="card-body">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #E0E7FF, #DBEAFE); border-bottom: 2px solid #2563EB;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Employ√©</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Poste</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">Arriv√©e</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">D√©part</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">H. Travaill√©es</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">% Pr√©sence</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">Statut</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in presences_data %}
                            <tr style="border-bottom: 1px solid #E5E7EB;">
                                <td style="padding: 12px; font-weight: 500;">{{ item.presence.employe.get_full_name }}</td>
                                <td style="padding: 12px;">{{ item.presence.employe.get_role_display }}</td>
                                <td style="padding: 12px; text-align: center;">
                                    {% if item.presence.heure_arrivee %}
                                        {{ item.presence.heure_arrivee|time:"H:i" }}
                                    {% else %}
                                        <span style="color: #EF4444; font-weight: 600;">Non point√©</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 12px; text-align: center;">
                                    {% if item.presence.heure_depart %}
                                        {{ item.presence.heure_depart|time:"H:i" }}
                                    {% else %}
                                        <span style="color: #6B7280;">En cours</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 12px; text-align: center; font-weight: 600; color: #2563EB;">
                                    {% if item.heures_travaillees > 0 %}
                                        {{ item.heures_travaillees }}h
                                    {% else %}
                                        <span style="color: #6B7280;">-</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">
                                    {% if item.pourcentage > 0 %}
                                        <span style="color: {% if item.pourcentage >= 60 %}#059669{% else %}#DC2626{% endif %};">
                                            {{ item.pourcentage|floatformat:0 }}%
                                        </span>
                                    {% else %}
                                        <span style="color: #6B7280;">-</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 12px; text-align: center;">
                                    {% if item.presence.statut == 'PRESENT' %}
                                        <span style="background: #D1FAE5; color: #065F46; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: 600;">‚úÖ Pr√©sent</span>
                                    {% elif item.presence.statut == 'RETARD' %}
                                        <span style="background: #FEF3C7; color: #92400E; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: 600;">‚ö†Ô∏è Retard</span>
                                    {% else %}
                                        <span style="background: #FEE2E2; color: #991B1B; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: 600;">‚ùå Absent</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 12px; text-align: center;">
                                    <span style="color: #6B7280; font-size: 0.85em;">Automatique</span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="8" style="padding: 40px; text-align: center; color: #6B7280;">
                                    Aucune pr√©sence enregistr√©e pour aujourd'hui
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Statistiques -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                <div class="stat-card" style="background: linear-gradient(135deg, #D1FAE5, #A7F3D0); padding: 20px; border-radius: 12px;">
                    <div style="font-size: 2em; margin-bottom: 10px;">‚úÖ</div>
                    <div style="font-size: 2em; font-weight: 700; color: #065F46;">{{ total_presents }}</div>
                    <div style="color: #047857; font-weight: 500;">Pr√©sents</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #FEF3C7, #FDE68A); padding: 20px; border-radius: 12px;">
                    <div style="font-size: 2em; margin-bottom: 10px;">‚ö†Ô∏è</div>
                    <div style="font-size: 2em; font-weight: 700; color: #92400E;">{{ total_retards }}</div>
                    <div style="color: #78350F; font-weight: 500;">En Retard</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #FEE2E2, #FECACA); padding: 20px; border-radius: 12px;">
                    <div style="font-size: 2em; margin-bottom: 10px;">‚ùå</div>
                    <div style="font-size: 2em; font-weight: 700; color: #991B1B;">{{ total_absents }}</div>
                    <div style="color: #7F1D1D; font-weight: 500;">Absents</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #E0E7FF, #C7D2FE); padding: 20px; border-radius: 12px;">
                    <div style="font-size: 2em; margin-bottom: 10px;">üë•</div>
                    <div style="font-size: 2em; font-weight: 700; color: #1E40AF;">{{ employes.count }}</div>
                    <div style="color: #1E3A8A; font-weight: 500;">Total Employ√©s</div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
