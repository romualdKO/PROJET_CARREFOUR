{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendrier des Cong√©s - RH</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>üìÖ Calendrier des Cong√©s {{ year }}</h2>
                <div>
                    <select id="year_selector" class="form-select d-inline-block w-auto me-2">
                        {% for y in years %}
                            <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
                        {% endfor %}
                    </select>
                    <a href="{% url 'rh_conges' %}" class="btn btn-secondary">
                        <i class="fas fa-list"></i> Liste
                    </a>
                </div>
            </div>

            <!-- L√©gende -->
            <div class="card mb-4">
                <div class="card-body">
                    <strong>L√©gende:</strong>
                    <span class="badge bg-primary ms-3">Cong√© annuel</span>
                    <span class="badge bg-warning ms-2">Cong√© maladie</span>
                    <span class="badge bg-info ms-2">Cong√© maternit√©</span>
                    <span class="badge bg-secondary ms-2">Cong√© sans solde</span>
                </div>
            </div>

            <!-- Timeline des cong√©s -->
            <div class="card">
                <div class="card-body">
                    {% if conges_data %}
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th style="width: 200px;">EMPLOY√â</th>
                                        <th style="width: 150px;">TYPE</th>
                                        <th>JANVIER</th>
                                        <th>F√âVRIER</th>
                                        <th>MARS</th>
                                        <th>AVRIL</th>
                                        <th>MAI</th>
                                        <th>JUIN</th>
                                        <th>JUILLET</th>
                                        <th>AO√õT</th>
                                        <th>SEPTEMBRE</th>
                                        <th>OCTOBRE</th>
                                        <th>NOVEMBRE</th>
                                        <th>D√âCEMBRE</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for conge in conges_data %}
                                        <tr>
                                            <td><strong>{{ conge.employe }}</strong></td>
                                            <td>
                                                {% if 'annuel' in conge.type|lower %}
                                                    <span class="badge bg-primary">{{ conge.type }}</span>
                                                {% elif 'maladie' in conge.type|lower %}
                                                    <span class="badge bg-warning">{{ conge.type }}</span>
                                                {% elif 'maternit√©' in conge.type|lower or 'maternite' in conge.type|lower %}
                                                    <span class="badge bg-info">{{ conge.type }}</span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ conge.type }}</span>
                                                {% endif %}
                                            </td>
                                            {% for month in '123456789012' %}
                                                <td class="text-center conge-cell" 
                                                    data-debut="{{ conge.date_debut }}" 
                                                    data-fin="{{ conge.date_fin }}"
                                                    data-month="{{ forloop.counter }}">
                                                    <span class="conge-indicator"></span>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Liste d√©taill√©e -->
                        <hr class="my-4">
                        <h5>üìã Liste D√©taill√©e</h5>
                        <div class="table-responsive mt-3">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>EMPLOY√â</th>
                                        <th>TYPE</th>
                                        <th>D√âBUT</th>
                                        <th>FIN</th>
                                        <th>DUR√âE</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for conge in conges_data %}
                                        <tr>
                                            <td>{{ conge.employe }}</td>
                                            <td>{{ conge.type }}</td>
                                            <td>{{ conge.date_debut }}</td>
                                            <td>{{ conge.date_fin }}</td>
                                            <td><strong>{{ conge.nb_jours }} jour{{ conge.nb_jours|pluralize }}</strong></td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-center text-muted my-5">
                            Aucun cong√© approuv√© pour l'ann√©e {{ year }}.
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.conge-cell {
    padding: 5px;
    vertical-align: middle;
}
.conge-indicator {
    display: inline-block;
    width: 20px;
    height: 20px;
    border-radius: 3px;
}
.conge-active {
    background-color: #198754 !important;
}
</style>

<script>
// Changer d'ann√©e
document.getElementById('year_selector').addEventListener('change', function() {
    window.location.href = '?year=' + this.value;
});

// Colorier les cellules pour les mois de cong√©
document.addEventListener('DOMContentLoaded', function() {
    const cells = document.querySelectorAll('.conge-cell');
    
    cells.forEach(cell => {
        const debut = new Date(cell.dataset.debut);
        const fin = new Date(cell.dataset.fin);
        const month = parseInt(cell.dataset.month);
        
        const debutMonth = debut.getMonth() + 1;
        const finMonth = fin.getMonth() + 1;
        
        // Si le cong√© couvre ce mois
        if (month >= debutMonth && month <= finMonth) {
            const indicator = cell.querySelector('.conge-indicator');
            indicator.classList.add('conge-active');
            
            // Tooltip
            cell.title = `${debut.toLocaleDateString('fr-FR')} - ${fin.toLocaleDateString('fr-FR')}`;
        }
    });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
